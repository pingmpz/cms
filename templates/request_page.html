<!DOCTYPE html>
{% load static %}
{% load extra %}

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>{{request_no}} | C.C.S. Maintenance Service</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
        <meta content="Coderthemes" name="author" />
        <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">

        <!-- App css -->
        <link href="{% static "assets/css/icons.min.css" %}" rel="stylesheet" type="text/css" />
        <link href="{% static "assets/css/app-modern.min.css" %}" rel="stylesheet" type="text/css" id="light-style" />
        <link href="{% static "assets/css/app-modern-dark.min.css" %}" rel="stylesheet" type="text/css" id="dark-style" />

        <!-- DataTable css -->
        <link href="{% static "assets/css/vendor/dataTables.bootstrap5.css" %}" rel="stylesheet" type="text/css" />
        <link href="{% static "assets/css/vendor/responsive.bootstrap5.css" %}" rel="stylesheet" type="text/css" />
        <link href="{% static "assets/css/vendor/buttons.bootstrap5.css" %}" rel="stylesheet" type="text/css" />
        <link href="{% static "assets/css/vendor/select.bootstrap5.css" %}" rel="stylesheet" type="text/css" />
        <link href="{% static "assets/css/vendor/fixedHeader.bootstrap5.css" %}" rel="stylesheet" type="text/css" />
        <!-- <link href="{% static "assets/css/vendor/fixedColumns.bootstrap5.css" %}" rel="stylesheet" type="text/css" /> -->

    </head>

    <body class="loading" data-layout="detached" data-layout-config='{"leftSidebarCondensed":{% if request.user.employee.sidebar == 'Condensed' %}true{% else %}false{% endif %},"darkMode":{% if request.user.employee.scheme == 'Dark Mode' %}true{% else %}false{% endif %}, "showRightSidebarOnStart":false}'>

        <!-- ========== Pre-Loader ========== -->
        <div id="preloader">
            <div id="status">
                <div class="bouncing-loader"><div></div><div></div><div></div></div>
            </div>
        </div>

        <!-- ========== Header Bar ========== -->
        {% include 'header.html' %}

        <div class="container-fluid">
            <div class="wrapper">

                <!-- ========== Left Sidebar ========== -->
                {% include 'sidebar.html' %}

                <!-- ========== Page Content ========== -->
                <div class="content-page">
                    <div class="content">

                        <!-- ========== Inner Top Bar ========== -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <div class="page-title-right d-flex">

                                    </div>
                                    <h4 class="page-title"><i class="uil-comment-dots"></i> {{request_no}} {% if request.user.is_superuser %}[{{req.id}}]{% endif %}</h4>
                                </div>
                            </div>
                        </div>

                        {% if req_is_exist %}
                        <!-- ========== Main Content ========== -->
                        <div class="row">

                            <!-- ========== Left Content ========== -->
                            <div class="col-xxl-3 col-lg-6 order-lg-1 order-xxl-1">
                              <input type="text" id="req_id" value="{{req.id}}" hidden>

                              <!-- ========== Pending ========== -->
                              {% if req.status == 'Pending' %}
                              <div class="card bg-warning text-white">
                                  <div class="card-body p-2">
                                      <h3 class="mb-2 mt-2 text-center"><i class='mdi mdi-clock-time-eight-outline'></i> Pending</h3>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== Rejected ========== -->
                              {% if req.status == 'Rejected' %}
                              <div class="card bg-danger text-white">
                                  <div class="card-body p-2">
                                      <h3 class="mb-2 mt-2 text-center"><i class='uil-times'></i> Rejected</h3>
                                      <p class="mb-2 mt-2 text-center">{{req.reason}}</p>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== On Progress ========== -->
                              {% if req.status == 'On Progress' %}
                              <div class="card bg-primary text-white">
                                  <div class="card-body p-2">
                                      <h3 class="mb-2 mt-2 text-center"><i class='uil-play'></i> On Pogress</h3>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== On Hold ========== -->
                              {% if req.status == 'On Hold' %}
                              <div class="card bg-dark text-white">
                                  <div class="card-body p-2">
                                      <h3 class="mb-2 mt-2 text-center"><i class='uil-pause'></i> On Hold</h3>
                                      <p class="mb-2 mt-2 text-center">{{req.reason}}</p>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== Complete ========== -->
                              {% if req.status == 'Complete' %}
                              <div class="card bg-success text-white">
                                  <div class="card-body p-2">
                                      <h3 class="mb-2 mt-2 text-center"><i class='mdi mdi-check-all'></i> Complete</h3>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== Canceled ========== -->
                              {% if req.status == 'Canceled' %}
                              <div class="card bg-danger text-white">
                                  <div class="card-body p-2">
                                      <h3 class="mb-2 mt-2 text-center"><i class='mdi mdi-cancel'></i> Canceled</h3>
                                      <p class="mb-2 mt-2 text-center">{{req.reason}}</p>
                                  </div>
                              </div>
                              {% endif %}

                              {% if req.status != 'Pending' and req.status != 'Rejected' %}
                              <!-- ========== Request Detail ========== -->
                              <div class="card tilebox-one">
                                  <div class="card-body">
                                      <h6 class="header-title mt-0">Request Detail</h6>
                                      <p class="my-2 small">{{req.description}}</p>
                                      <p class="mb-0 text-muted small">Request To: {{req.sg.name}}</p>
                                      <p class="mb-0 text-muted small">Type: {{req.type}}</p>
                                      <p class="mb-0 text-muted small">Request Date: {{req.request_date}}</p>
                                      {% if req.status == 'Complete' or req.status == 'Canceled' %}
                                      <p class="mb-0 text-muted small">Finish Date: {{req.finish_datetime}}</p>
                                      {% endif %}
                                      <p class="mb-0 text-muted small">Created Date: {{req.date_published}}</p>
                                      <p class="mb-0 text-muted small">Modified Date: {{req.date_modified}}</p>
                                  </div>
                              </div>

                              <!-- ========== Category ========== -->
                              <div class="card">
                                    <div class="card-body">
                                        <div class="dropdown float-end">
                                        </div>
                                        <h4 class="header-title mb-3">Category {% if req_sub_cats %}({{req_sub_cats|length}}){% endif %}</h4>
                                        {% for req_sub_cat in req_sub_cats %}
                                        {% if set_rsc|index:forloop.counter0 != None %}
                                        <div class="d-flex mt-2"><i class="mdi mdi-label text-info"></i>&nbsp;&nbsp;&nbsp;{{set_rsc|index:forloop.counter0}}</div>
                                        {% endif %}
                                        <div class="d-flex mt-1 font-12">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp;{{req_sub_cat.sub_cat.name|title}} {% if request.user.is_superuser %}[{{req_sub_cat.id}}]{% endif %}</div>
                                        {% endfor %}
                                        {% if req_sub_cats|length == 0 %}
                                        <p class="text-center">There is no category for this request.</p>
                                        {% endif %}
                                    </div>
                                </div>

                              <!-- ========== Machine & Device ========== -->
                              {% if req.mc %}
                              <div class="card tilebox-one">
                                  <div class="card-body">
                                      <i class="mdi mdi-cogs float-end"></i>
                                      <h6 class="header-title mt-0">Machine & Device</h6>
                                      <h3 class="my-2">&nbsp;&nbsp;&nbsp;{{req.mc.mc_no}}</h3>
                                      <p class="mb-0 text-muted small">Section: {{req.mc.section|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Machine Group: {{req.mc.mcg.name|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Register No: {{req.mc.register_no|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Asset No: 	{{req.mc.asset_no|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Manufacture: {{req.mc.manufacture|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Plant: {{req.mc.plant|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Model: {{req.mc.model|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Serial No: {{req.mc.serial_no|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Capacity: {{req.mc.capacity|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Power: {{req.mc.power|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Install Date: {{req.mc.install_date|default_if_none:"-"}}</p>
                                      <p class="mb-0 text-muted small">Note: {{req.mc.note|default_if_none:"-"}}</p>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== Task ========== -->
                              {% if req.task %}
                              <div class="card tilebox-one">
                                  <div class="card-body">
                                      <i class="mdi mdi-clipboard-outline float-end"></i>
                                      <h6 class="header-title mt-0">Task</h6>
                                      <h3 class="my-2">&nbsp;&nbsp;&nbsp;{{req.task.type}}</h3>
                                      <p class="my-2">&nbsp;&nbsp;&nbsp;"{{req.task.name}}"</p>
                                      <p class="mb-0 text-muted small">Note: {{req.task.note|default_if_none:"-"}}</p>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== Requester ========== -->
                              <div class="card tilebox-one">
                                  <div class="card-body">
                                      <i class="uil uil-user float-end"></i>
                                      <h6 class="header-title mt-0">Requester</h6>
                                      <h2 class="my-2">&nbsp;&nbsp;&nbsp;{{req.emp_id}}</h2>
                                      <p class="mb-0 text-muted small">{{req.name|title}} ({{req.section}})</p>
                                      <p class="mb-0 text-muted small">Email: {{req.email}}</p>
                                      <p class="mb-0 text-muted small">Phone No: {{req.phone_no}}</p>
                                  </div>
                              </div>
                              {% endif %}

                              <!-- ========== Files ========== -->
                              <div class="card">
                                  <div class="card-body">
                                      <div class="dropdown float-end">
                                      </div>
                                      <h4 class="header-title mb-3">Files {% if files %}({{files|length}}){% endif %}</h4>
                                      {% for file in files %}
                                      <div class="card mb-1 shadow-none border">
                                          <div class="p-2">
                                              <div class="row align-items-center">
                                                  <div class="col-auto">
                                                      <div class="avatar-sm">
                                                          <span class="avatar-title rounded"><img src="/media/request/{{request_no}}/{{file.file_name}}" onerror="this.onerror=null; this.src='/media/file.png'" width="50" height="50"></span>
                                                      </div>
                                                  </div>
                                                  <div class="col ps-0">
                                                      <a href="/media/request/{{request_no}}/{{file.file_name}}" class="text-muted fw-bold">{{file.file_name}}</a>
                                                  </div>
                                                  <div class="col-auto">
                                                    {% if req.status == 'On Progress' or req.status == 'On Hold' %}
                                                    {% if is_member %}
                                                    <button type="button" class="btn btn-lg btn-link text-muted"  data-bs-toggle="modal" data-bs-target="#delete_file_modal"
                                                    onclick="prepare_delete_file({{file.id}})"><i class="uil-trash"></i></button>
                                                    {% endif %}
                                                    {% endif %}
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                      {% endfor %}
                                      {% if files|length == 0 %}
                                      <p class="text-center">There is no file for this request.</p>
                                      {% endif %}
                                  </div>
                              </div>

                            </div>

                            <!-- ========== Middle Content ========== -->
                            <div class="col-xxl-6 col-lg-12 order-lg-2 order-xxl-1">

                                {% if req.status == 'Pending' or req.status == 'Rejected' %}
                                <!-- ========== Request Detail ========== -->
                                <div class="card tilebox-one">
                                    <div class="card-body">
                                        <h6 class="header-title mt-0">Request Detail</h6>
                                        <p class="my-3">{{req.description}}</p>
                                        <p class="mb-0 text-muted small">Request To: {{req.sg.name}}</p>
                                        <p class="mb-0 text-muted small">Type: {{req.type}}</p>
                                        <p class="mb-0 text-muted small">Request Date: {{req.request_date}}</p>
                                        {% if req.status == 'Rejected' %}
                                        <p class="mb-0 text-muted small">Finish Date: {{req.finish_datetime}}</p>
                                        {% endif %}
                                        <p class="mb-0 text-muted small">Created Date: {{req.date_published}}</p>
                                        <p class="mb-0 text-muted small">Modified Date: {{req.date_modified}}</p>
                                    </div>
                                </div>

                                <div class="row">
                                  <div class="col-6">
                                    <!-- ========== Requester ========== -->
                                    <div class="card tilebox-one">
                                        <div class="card-body">
                                            <i class="uil uil-user float-end"></i>
                                            <h6 class="header-title mt-0">Requester</h6>
                                            <h2 class="my-2">&nbsp;&nbsp;&nbsp;{{req.emp_id}}</h2>
                                            <p class="mb-0 text-muted small">{{req.name|title}} ({{req.section}})</p>
                                            <p class="mb-0 text-muted small">Email: {{req.email}}</p>
                                            <p class="mb-0 text-muted small">Phone No: {{req.phone_no}}</p>
                                        </div>
                                    </div>
                                  </div>
                                  <div class="col-6">
                                    <!-- ========== Machine & Device ========== -->
                                    {% if req.mc %}
                                    <div class="card tilebox-one">
                                        <div class="card-body">
                                            <i class="mdi mdi-cogs float-end"></i>
                                            <h6 class="header-title mt-0">Machine & Device</h6>
                                            <h3 class="my-2">&nbsp;&nbsp;&nbsp;{{req.mc.mc_no}}</h3>
                                            <p class="mb-0 text-muted small">Section: {{req.mc.section|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Machine Group: {{req.mc.mcg.name|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Register No: {{req.mc.register_no|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Asset No: 	{{req.mc.asset_no|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Manufacture: {{req.mc.manufacture|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Plant: {{req.mc.plant|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Model: {{req.mc.model|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Serial No: {{req.mc.serial_no|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Capacity: {{req.mc.capacity|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Power: {{req.mc.power|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Install Date: {{req.mc.install_date|default_if_none:"-"}}</p>
                                            <p class="mb-0 text-muted small">Note: {{req.mc.note|default_if_none:"-"}}</p>
                                        </div>
                                    </div>
                                    {% endif %}

                                    <!-- ========== Task ========== -->
                                    {% if req.task %}
                                    <div class="card tilebox-one">
                                        <div class="card-body">
                                            <i class="mdi mdi-clipboard-outline float-end"></i>
                                            <h6 class="header-title mt-0">Task</h6>
                                            <h3 class="my-2">&nbsp;&nbsp;&nbsp;{{req.task.type}}</h3>
                                            <p class="my-2">&nbsp;&nbsp;&nbsp;"{{req.task.name}}"</p>
                                            <p class="mb-0 text-muted small">Note: {{req.task.note|default_if_none:"-"}}</p>
                                        </div>
                                    </div>
                                    {% endif %}
                                  </div>
                                </div>
                                {% endif %}

                                <!-- ========== Complete Conclusion Box ========== -->
                                {% if req.status == 'Complete' %}
                                <div class="card cta-box widget-flat bg-success text-white">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi mdi-check-all widget-icon bg-light-lighten rounded-circle text-white"></i>
                                        </div>
                                        <p class="text-uppercase mb-0"><b><u>Corrective Action</u></b>{{req.corrective_action|default_if_none:"-"|linebreaks}}</p>
                                        <p class="text-uppercase mb-0"><b><u>Cause</u></b>{{req.cause|default_if_none:"-"|linebreaks}}</p>
                                        <p class="text-uppercase mb-0"><b><u>Spare Parts Changed</u></b>{{req.spare_parts|default_if_none:"-"|linebreaks}}</p>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- ========== Main Tab ========== -->
                                {% if req.status != 'Pending' and req.status != 'Rejected' %}
                                <div class="card">
                                    <div class="card-body">
                                        <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                            <li class="nav-item">
                                                <a href="#comment" data-bs-toggle="tab" aria-expanded="false" class="nav-link active px-3 py-2">
                                                    <i class="mdi mdi-pencil-box-multiple font-18 d-md-none d-block"></i>
                                                    <span class="d-none d-md-block small">Comments {% if comments %}({{comments|length}}){% endif %}</span>
                                                </a>
                                            </li>
                                            <li class="nav-item">
                                                <a href="#operate_time" data-bs-toggle="tab" aria-expanded="true" class="nav-link px-3 py-2">
                                                    <i class="mdi mdi-book-open-variant font-18 d-md-none d-block"></i>
                                                    <span class="d-none d-md-block small">Working Time {% if wt_len %}({{wt_len}}){% endif %}</span>
                                                </a>
                                            </li>
                                            {% if req.mc %}
                                            <li class="nav-item">
                                                <a href="#mc_downtime" data-bs-toggle="tab" aria-expanded="true" class="nav-link px-3 py-2">
                                                    <i class="mdi mdi-book-open-variant font-18 d-md-none d-block"></i>
                                                    <span class="d-none d-md-block small">Machine Downtime {% if mcdts %}({{mcdts|length}}){% endif %}</span>
                                                </a>
                                            </li>
                                            {% endif %}
                                            <li class="nav-item">
                                                <a href="#costing" data-bs-toggle="tab" aria-expanded="true" class="nav-link px-3 py-2">
                                                    <i class="mdi mdi-book-open-variant font-18 d-md-none d-block"></i>
                                                    <span class="d-none d-md-block small">Costing {% if costs %}({{costs|length}}){% endif %}</span>
                                                </a>
                                            </li>
                                        </ul>

                                        <div class="tab-content">
                                            <!-- ========== Comment Tab ========== -->
                                            <div class="tab-pane show active p-0" id="comment">
                                                <!-- ========== New Comment ========== -->
                                                {% if req.status == 'On Progress' or req.status == 'On Hold' %}
                                                {% if is_member %}
                                                <div class="border rounded">
                                                    <form action="#" class="comment-area-box">
                                                        <textarea rows="4" class="form-control border-0 resize-none" id="comment_text"></textarea>
                                                        <div class="p-2 bg-light d-flex justify-content-between align-items-center">
                                                            <div></div>
                                                            <button type="submit" class="btn btn-sm btn-primary" onclick="post_comment()"><i class='uil uil-message me-1'></i>Post</button>
                                                        </div>
                                                    </form>
                                                </div>
                                                <br>
                                                {% endif %}
                                                {% endif %}
                                                <!-- ========== Comment List ========== -->
                                                {% if comments|length > 0 %}
                                                <div class="timeline-alt pb-0">

                                                    {% for comment in comments %}
                                                    <div class="timeline-item">
                                                        <div class="float-end">
                                                          {% if req.status == 'On Progress' or req.status == 'On Hold' %}
                                                          {% if is_member %}
                                                          <button type="button" class="btn btn-sm btn-link text-muted"  data-bs-toggle="modal" data-bs-target="#delete_comment_modal"
                                                          onclick="prepare_delete_comment({{comment.id}})"><i class="uil-trash"></i></button>
                                                          {% endif %}
                                                          {% endif %}
                                                        </div>
                                                        <i class="mdi mdi-circle bg-primary-lighten text-primary timeline-icon"></i>
                                                        <div class="timeline-item-info">
                                                            <h5 class="mt-0 mb-1">{{comment.user.username}} | {{comment.user.employee.name|title}} {% if request.user.is_superuser %}[{{comment.id}}]{% endif %}</h5>
                                                            <p class="font-12"><i class="mdi mdi-clock-time-eight-outline"></i> {{comment.date_published}}</span></p>
                                                            <p class="text-muted mt-2 mb-0 pb-3 text-center">{{comment.text|linebreaks}}</p>
                                                            <hr>
                                                        </div>
                                                    </div>
                                                    {% endfor %}

                                                </div>
                                                {% endif %}

                                                {% if comments|length == 0 %}
                                                <div class="timeline-item">
                                                    <h4 class="text-center pt-3 pb-3">There is no comment in this request.</h4>
                                                </div>
                                                {% endif %}

                                            </div>

                                            <!-- ========== Operate Time Tab ========== -->
                                            <div class="tab-pane p-0" id="operate_time">
                                              <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                                  <li class="nav-item small">
                                                      <a href="#operator" data-bs-toggle="tab" aria-expanded="false" class="nav-link active">
                                                          <i class="mdi mdi-home-variant d-md-none d-block"></i>
                                                          <span class="d-none d-md-block">Operator {% if owts %}({{owts|length}}){% endif %}</span>
                                                      </a>
                                                  </li>
                                                  <li class="nav-item small">
                                                      <a href="#vendor" data-bs-toggle="tab" aria-expanded="true" class="nav-link">
                                                          <i class="mdi mdi-account-circle d-md-none d-block"></i>
                                                          <span class="d-none d-md-block">Vendor {% if vwts %}({{vwts|length}}){% endif %}</span>
                                                      </a>
                                                  </li>
                                              </ul>

                                              <!-- ========== Working Time Tab ========== -->
                                              <div class="tab-content">
                                                  <!-- ========== Operator Tab ========== -->
                                                  <div class="tab-pane active" id="operator">
                                                    <!-- ========== Add Operate Time ========== -->
                                                    {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                                    {% if is_member or request.user.is_superuser or request.user.is_staff %}
                                                    <p class="text-muted font-12">Use 'CTRL' to select multiple item</p>
                                                    <div class="row">
                                                      <div class="col-10">
                                                        <div class="mb-3">
                                                          <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="owt_username_list">
                                                              {% for member in members %}
                                                              <option value="{{member.user.username}}" {% if request.user.employee.default_owt == 'All Member' %}selected{% elif request.user.employee.default_owt == 'Only Me' and request.user == member.user %}selected{% endif %}>
                                                                {{member.user.username}} | {{member.user.employee.name|title}} ({{member.user.employee.section}})
                                                              </option>
                                                              {% endfor %}
                                                          </select>
                                                        </div>
                                                      </div>
                                                      <div class="col-2">
                                                        <div class="mb-3">
                                                          <button type="submit" class="btn btn-sm btn-success" onclick="owt_save()"><i class='mdi mdi-content-save me-1'></i>Save</button>
                                                        </div>
                                                      </div>
                                                      <div class="col-6">
                                                        <div class="mb-0">
                                                          <label class="form-label">StartDateTime</label>
                                                          <input type="datetime-local" class="form-control" name="section"  id="owt_start_datetime">
                                                        </div>
                                                      </div>
                                                      <div class="col-6">
                                                        <div class="mb-0">
                                                          <label class="form-label">StopDateTime</label>
                                                          <input type="datetime-local" class="form-control" name="phone_no"  id="owt_stop_datetime">
                                                        </div>
                                                      </div>
                                                    </div>
                                                    <p class="text-muted font-12 mt-1">* 12 AM = Midnight, 12 PM = Noon</p>
                                                    <hr>
                                                    {% endif %}
                                                    {% endif %}
                                                    <!-- ========== Operate Working Time Table ========== -->
                                                    {% if owts|length > 0 %}
                                                    <table id="owt_table" class="table table-sm nowrap dt-responsive row-border order-column w-100 small">
                                                      <thead class="table-light">
                                                          <tr>
                                                              <th {% if not request.user.is_superuser %}hidden{% endif %}>ID</th>
                                                              <th>Employee ID</th>
                                                              <th>Name</th>
                                                              <th>StartDateTime</th>
                                                              <th>StopDateTime</th>
                                                              <th></th>
                                                          </tr>
                                                      </thead>
                                                      <tbody>
                                                          {% for owt in owts %}
                                                          <tr>
                                                              <td {% if not request.user.is_superuser %}hidden{% endif %}>{{owt.id}}</td>
                                                              <td>{{owt.user.username}}</td>
                                                              <td>{{owt.user.employee.name|title}}</td>
                                                              <td>{{owt.start_datetime}}</td>
                                                              <td>{{owt.stop_datetime}}</td>
                                                              <td>
                                                                {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                                                {% if is_member and req.status != 'Complete' %}
                                                                <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_owt_modal"
                                                                onclick="prepare_delete_owt({{owt.id}})"><i class="uil-trash"></i></button>
                                                                {% elif request.user.is_superuser or request.user.is_staff %}
                                                                <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_owt_modal"
                                                                onclick="prepare_delete_owt({{owt.id}})"><i class="uil-trash"></i></button>
                                                                {% endif %}
                                                                {% endif %}
                                                              </td>
                                                          </tr>
                                                          {% endfor %}
                                                      </tbody>
                                                    </table>
                                                    {% else %}
                                                    <div class="timeline-item">
                                                        <h4 class="text-center pt-3 pb-3">There is no operator working time in this request.</h4>
                                                    </div>
                                                    {% endif %}
                                                  </div>

                                                  <!-- ========== Vendors Tab ========== -->
                                                  <div class="tab-pane show" id="vendor">
                                                    <!-- ========== Add Operate Time ========== -->
                                                    {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                                    {% if is_member or request.user.is_superuser or request.user.is_staff %}
                                                    <p class="text-muted font-12">Use 'CTRL' to select multiple item</p>
                                                    <div class="row">
                                                      <div class="col-10">
                                                        <div class="mb-3">
                                                          <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="vwt_ven_code_list">
                                                              {% for req_ven in req_vens %}
                                                              <option value="{{req_ven.ven.code}}">{{req_ven.ven.code}} | {{req_ven.ven.name}}</option>
                                                              {% endfor %}
                                                          </select>
                                                        </div>
                                                      </div>
                                                      <div class="col-2">
                                                        <div class="mb-3">
                                                          <button type="submit" class="btn btn-sm btn-success" onclick="vwt_save()"><i class='mdi mdi-content-save me-1'></i>Save</button>
                                                        </div>
                                                      </div>
                                                      <div class="col-6">
                                                        <div class="mb-0">
                                                          <label class="form-label">StartDateTime</label>
                                                          <input type="datetime-local" class="form-control" name="section"  id="vwt_start_datetime">
                                                        </div>
                                                      </div>
                                                      <div class="col-6">
                                                        <div class="mb-0">
                                                          <label class="form-label">StopDateTime</label>
                                                          <input type="datetime-local" class="form-control" name="phone_no"  id="vwt_stop_datetime">
                                                        </div>
                                                      </div>
                                                    </div>
                                                    <p class="text-muted font-12 mt-1">* 12 AM = Midnight, 12 PM = Noon</p>
                                                    <hr>
                                                    {% endif %}
                                                    {% endif %}
                                                    <!-- ========== Vendor Working Time Table ========== -->
                                                    {% if vwts|length > 0 %}
                                                    <table id="vwt_table" class="table table-sm nowrap dt-responsive row-border order-column w-100 small">
                                                      <thead class="table-light">
                                                          <tr>
                                                              <th {% if not request.user.is_superuser %}hidden{% endif %}>ID</th>
                                                              <th>Vendor Code</th>
                                                              <th>Name</th>
                                                              <th>StartDateTime</th>
                                                              <th>StopDateTime</th>
                                                              <th></th>
                                                          </tr>
                                                      </thead>
                                                      <tbody>
                                                          {% for vwt in vwts %}
                                                          <tr>
                                                              <td {% if not request.user.is_superuser %}hidden{% endif %}>{{vwt.id}}</td>
                                                              <td>{{vwt.ven.code}}</td>
                                                              <td>{{vwt.ven.name}}</td>
                                                              <td>{{vwt.start_datetime}}</td>
                                                              <td>{{vwt.stop_datetime}}</td>
                                                              <td>
                                                                {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                                                {% if is_member and req.status != 'Complete' %}
                                                                <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_vwt_modal"
                                                                onclick="prepare_delete_vwt({{vwt.id}})"><i class="uil-trash"></i></button>
                                                                {% elif request.user.is_superuser or request.user.is_staff %}
                                                                <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_vwt_modal"
                                                                onclick="prepare_delete_vwt({{vwt.id}})"><i class="uil-trash"></i></button>
                                                                {% endif %}
                                                                {% endif %}
                                                              </td>
                                                          </tr>
                                                          {% endfor %}
                                                      </tbody>
                                                    </table>
                                                    {% else %}
                                                    <div class="timeline-item">
                                                        <h4 class="text-center pt-3 pb-3">There is no vendor working time in this request.</h4>
                                                    </div>
                                                    {% endif %}
                                                  </div>
                                              </div>
                                            </div>

                                            <!-- ========== Machine Downtime Tab ========== -->
                                            <div class="tab-pane p-0" id="mc_downtime">
                                              <!-- ========== Add Machine Downtime ========== -->
                                              {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                              {% if is_member or request.user.is_superuser or request.user.is_staff %}
                                              <div class="row">
                                                <div class="col-10">
                                                  <div class="mb-3">
                                                    <label class="form-label">Machine No</label>
                                                    <input type="text" class="form-control" id="mcdt_mc_no" value="{{req.mc.mc_no}}" readonly>
                                                  </div>
                                                </div>
                                                <div class="col-2">
                                                  <div class="mb-3">
                                                    <label class="form-label">ㅤ</label>
                                                    <button type="submit" class="btn btn-sm btn-success" onclick="mcdt_save()"><i class='mdi mdi-content-save me-1'></i>Save</button>
                                                  </div>
                                                </div>
                                                <div class="col-6">
                                                  <div class="mb-0">
                                                    <label class="form-label">StartDateTime</label>
                                                    <input type="datetime-local" class="form-control" name="section"  id="mcdt_start_datetime">
                                                  </div>
                                                </div>
                                                <div class="col-6">
                                                  <div class="mb-0">
                                                    <label class="form-label">StopDateTime</label>
                                                    <input type="datetime-local" class="form-control" name="phone_no"  id="mcdt_stop_datetime">
                                                  </div>
                                                </div>
                                              </div>
                                              <p class="text-muted font-12 mt-1">* 12 AM = Midnight, 12 PM = Noon</p>
                                              <hr>
                                              {% endif %}
                                              {% endif %}
                                              <!-- ========== Machine Downtime Table ========== -->
                                              {% if mcdts|length > 0 %}
                                              <table id="mcdt_table" class="table table-sm nowrap dt-responsive row-border order-column w-100 small">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th {% if not request.user.is_superuser %}hidden{% endif %}>ID</th>
                                                        <th>StartDateTime</th>
                                                        <th>StopDateTime</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for mcdt in mcdts %}
                                                    <tr>
                                                        <td {% if not request.user.is_superuser %}hidden{% endif %}>{{mcdt.id}}</td>
                                                        <td>{{mcdt.start_datetime}}</td>
                                                        <td>{{mcdt.stop_datetime}}</td>
                                                        <td>
                                                          {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                                          {% if is_member and req.status != 'Complete' %}
                                                          <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_mcdt_modal"
                                                          onclick="prepare_delete_mcdt({{mcdt.id}})"><i class="uil-trash"></i></button>
                                                          {% elif request.user.is_superuser or request.user.is_staff %}
                                                          <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_mcdt_modal"
                                                          onclick="prepare_delete_mcdt({{mcdt.id}})"><i class="uil-trash"></i></button>
                                                          {% endif %}
                                                          {% endif %}
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                              </table>
                                              {% else %}
                                              <div class="timeline-item">
                                                  <h4 class="text-center pt-3 pb-3">There is no machine downtime in this request.</h4>
                                              </div>
                                              {% endif %}
                                            </div>

                                            <!-- ========== Costing Tab ========== -->
                                            <div class="tab-pane p-0" id="costing">
                                              {% if req.status == 'On Progress' or req.status == 'On Hold' or req.status == 'Complete' %}
                                              {% if is_member %}
                                              <div class="row">
                                                <div class="col-5">
                                                  <div class="mb-3">
                                                    <label class="form-label">Name</label>
                                                    <input type="text" class="form-control" id="cost_name">
                                                  </div>
                                                </div>
                                                <div class="col-5">
                                                  <div class="mb-3">
                                                    <label class="form-label">Price (Bath)</label>
                                                    <input type="number" class="form-control" id="cost_price">
                                                  </div>
                                                </div>
                                                <div class="col-2">
                                                  <div class="mb-3">
                                                    <label class="form-label">ㅤ</label>
                                                    <button type="submit" class="btn btn-sm btn-success" onclick="cost_save()"><i class='mdi mdi-content-save me-1'></i>Save</button>
                                                  </div>
                                                </div>
                                              </div>
                                              <hr>
                                              {% endif %}
                                              {% endif %}
                                              <!-- ========== Costing Table ========== -->
                                              {% if costs|length > 0 %}
                                              <h4>Total Cost : {{total_cost|floatformat:0}} Bath</h4>
                                              <p class="mt-1"></p>
                                              <table id="mcdt_table" class="table table-sm nowrap dt-responsive row-border order-column w-100 small">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th {% if not request.user.is_superuser %}hidden{% endif %}>ID</th>
                                                        <th>Name</th>
                                                        <th>Price (Bath)</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for cost in costs %}
                                                    <tr>
                                                        <td {% if not request.user.is_superuser %}hidden{% endif %}>{{cost.id}}</td>
                                                        <td>{{cost.name}}</td>
                                                        <td>{{cost.price|floatformat:0}}</td>
                                                        <td>
                                                          {% if req.status == 'On Progress' or req.status == 'On Hold' %}
                                                          {% if is_member %}
                                                          <button type="button" class="btn btn-sm btn-link text-muted pt-0 pb-0"  data-bs-toggle="modal" data-bs-target="#delete_cost_modal"
                                                          onclick="prepare_delete_cost({{cost.id}})"><i class="uil-trash"></i></button>
                                                          {% endif %}
                                                          {% endif %}
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                              </table>
                                              {% else %}
                                              <div class="timeline-item">
                                                  <h4 class="text-center pt-3 pb-3">There is no costing in this request.</h4>
                                              </div>
                                              {% endif %}
                                            </div>

                                        </div>

                                    </div>
                                </div>
                                {% endif %}

                            </div>

                            <!-- ========== Right Content ========== -->
                            <div class="col-xxl-3 col-lg-6 order-lg-1 order-xxl-2">
                                <!-- ========== Functions ========== -->
                                <div class="card">
                                    <div class="card-body p-3">
                                        <div class="dropdown float-end">
                                        </div>
                                        <h4 class="header-title mb-3">Functions</h4>
                                        <div class="list-group list-group-flush my-2">
                                            {% if req.status == 'Pending' %}
                                            <button type="button" class="btn btn-xs mb-1 btn-success" data-bs-toggle="modal" data-bs-target="#accept_modal"><i class='uil-check me-1'></i>Accept</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-danger" data-bs-toggle="modal" data-bs-target="#reject_modal"><i class='uil-times me-1'></i>Reject</button>
                                            {% elif req.status == 'On Hold' and not is_member %}
                                            <button type="button" class="btn btn-xs mb-1 btn-outline-success" onclick="join_request()"><i class='uil-sign-in-alt me-1'></i>Join</button>
                                            {% elif req.status == 'On Hold' %}
                                            <a href="/edit_request/{{request_no}}" class="btn btn-xs mb-1 btn-warning"><i class='mdi mdi-lead-pencil me-1'></i>Edit Request</a>
                                            <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#manage_member_modal"><i class='mdi mdi-account-edit me-1'></i>Manage Member</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#manage_vendor_modal"><i class='mdi mdi-briefcase-edit me-1'></i>Manage Vendor</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#manage_category_modal"><i class='mdi mdi-puzzle-edit me-1'></i>Manage Category</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-primary" data-bs-toggle="modal" data-bs-target="#start_work_modal"><i class='uil-play me-1'></i>Start Work</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-danger" data-bs-toggle="modal" data-bs-target="#cancel_modal"><i class='mdi mdi-cancel me-1'></i>Cancel</button>
                                              {% if members|length > 1 %}
                                              <hr>
                                              <button type="button" class="btn btn-xs mb-1 btn-outline-danger" onclick="leave_request()"><i class='uil-sign-out-alt me-1'></i>Leave</button>
                                              {% endif %}
                                            {% elif req.status == 'On Progress' and not is_member %}
                                            <button type="button" class="btn btn-xs mb-1 btn-outline-success" onclick="join_request()"><i class='uil-sign-in-alt me-1'></i>Join</button>
                                            {% elif req.status == 'On Progress' %}
                                            <a href="/edit_request/{{request_no}}" class="btn btn-xs mb-1 btn-warning"><i class='mdi mdi-lead-pencil me-1'></i>Edit Request</a>
                                            <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#manage_member_modal"><i class='mdi mdi-account-edit me-1'></i>Manage Member</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#manage_vendor_modal"><i class='mdi mdi-briefcase-edit me-1'></i>Manage Vendor</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#manage_category_modal"><i class='mdi mdi-puzzle-edit me-1'></i>Manage Category</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-dark" data-bs-toggle="modal" data-bs-target="#hold_modal"><i class='uil-pause me-1'></i>Hold</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-success" data-bs-toggle="modal" data-bs-target="#complete_modal"><i class='mdi mdi-check-all me-1'></i>Complete</button>
                                            <button type="button" class="btn btn-xs mb-1 btn-danger" data-bs-toggle="modal" data-bs-target="#cancel_modal"><i class='mdi mdi-cancel me-1'></i>Cancel</button>
                                              {% if members|length > 1 %}
                                              <hr>
                                              <button type="button" class="btn btn-xs mb-1 btn-outline-danger" onclick="leave_request()"><i class='uil-sign-out-alt me-1'></i>Leave</button>
                                              {% endif %}
                                            {% elif req.status == 'Complete' or req.status == 'Canceled' %}
                                              {% if is_member %}
                                              <button type="button" class="btn btn-xs mb-1 btn-info" data-bs-toggle="modal" data-bs-target="#rework_modal"><i class='uil-redo me-1'></i>Rework</button>
                                              {% else %}
                                              <p class="text-center">There is no function for this request.</p>
                                              {% endif %}
                                            {% endif %}
                                            {% if req.status == 'Rejected' %}
                                            <p class="text-center">There is no function for this request.</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <!-- ========== Member ========== -->
                                {% if req.status != 'Pending' and req.status != 'Rejected' %}
                                <div class="card">
                                    <div class="card-body pb-3">
                                        <div class="dropdown float-end">
                                        </div>

                                        <h4 class="header-title mb-3">Members ({{members|length}})</h4>

                                        <div class="inbox-widget">
                                            {% for member in members %}
                                            <div class="inbox-item">
                                                <p class="inbox-item-author">{{member.user.username}} | {{member.user.employee.name|title}} {% if request.user.is_superuser %}[{{member.id}}]{% endif %}</p>
                                                <p class="inbox-item-text font-12">Section : {{member.user.employee.section}}</p>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- ========== Request Vendor ========== -->
                                {% if req.status != 'Pending' and req.status != 'Rejected' %}
                                <div class="card">
                                    <div class="card-body pb-3">
                                        <div class="dropdown float-end">
                                        </div>

                                        <h4 class="header-title mb-3">Vendors {% if req_vens %}({{req_vens|length}}){% endif %}</h4>

                                        <div class="inbox-widget">
                                            {% for req_ven in req_vens %}
                                            <div class="inbox-item">
                                              <p class="inbox-item-author">{{req_ven.ven.name}} {% if request.user.is_superuser %}[{{req_ven.id}}]{% endif %}</p>
                                              <p class="inbox-item-text font-12">Vendor Code : {{req_ven.ven.code}}</p>
                                              <p class="inbox-item-text font-12">Address : {{req_ven.ven.address|default_if_none:"-"}}</p>
                                              <p class="inbox-item-text font-12">Email : {{req_ven.ven.email|default_if_none:"-"}}</p>
                                              <p class="inbox-item-text font-12">Phone No : {{req_ven.ven.phone_no|default_if_none:"-"}}</p>
                                              <small class="inbox-item-text font-12">
                                                Note : {{req_ven.ven.note|linebreaks|default_if_none:"-"}}
                                              </small>
                                            </div>
                                            {% endfor %}
                                            {% if req_vens|length == 0 %}
                                            <p class="text-center">There is no vendor for this request.</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% else %}
                        <!-- ========== Not Found ========== -->
                        <div class="row justify-content-center mt-5">
                            <div class="col-lg-4">
                                <div class="text-center">
                                    <img src="{% static "assets/images/file-searching.svg" %}" height="360" alt="File not found Image">
                                    <h2 class="text-uppercase text-danger mt-4">Request Not Found</h2>
                                    <h4 class="text-muted mt-1">{{request_no}}</h4>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <!-- ========== Footer ========== -->
                    {% include 'footer.html' %}

                </div>
            </div>
        </div>

        <!-- ========== Right Side Bar ========== -->

        <!-- ========== Modal ========== -->
        <div>
          <!-- Accept -->
          <div id="accept_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-success">
                          <h4 class="modal-title"><i class='uil-check me-1'></i>Accept</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to accept this request ?</h5>
                          <div class="mb-3" {% if req.type == 'Preventive' %}hidden{% endif %}>
                            <label class="form-label">Machine & Device</label>
                            <select class="form-control select2" data-toggle="select2" name="accept_mc_no" id="accept_mc_no">
                              <option>Select</option>
                              {% for mc in mcs %}
                              {% if set_mc|index:forloop.counter0 != None %}
                              <optgroup label="{{set_mc|index:forloop.counter0}}">
                              {% endif %}
                              <option value="{{mc.mc_no}}" {% if req.mc == mc %}selected{% endif %}>▪️ {{mc.mc_no}}</option>
                              {% if set_mc|index:forloop.counter1 != None %}
                              </optgroup>
                              {% endif %}
                              {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Add Member</label>
                            <p class="text-muted font-12">Use 'CTRL' to select multiple item, Please select at least 1 person.</p>
                            <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="accept_username_list">
                                {% for user in users %}
                                {% if set_user|index:forloop.counter0 != None %}
                                <optgroup label="{{set_user|index:forloop.counter0}}">
                                {% endif %}
                                <option value="{{user.username}}" {% if request.user == user and request.user.employee.auto_add %}selected{% endif %}>▪️ {{user.username}} | {{user.employee.name|title}}</option>
                                {% if set_user|index:forloop.counter1 != None %}
                                </optgroup>
                                {% endif %}
                                {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Add Vendor</label>
                            <p class="text-muted font-12">Use 'CTRL' to select multiple item</p>
                            <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="accept_ven_code_list">
                                {% for ven in vens %}
                                <option value="{{ven.code}}">{{ven.code}} | {{ven.name}}</option>
                                {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Category</label>
                            <p class="text-muted font-12">Use 'CTRL' to select multiple item</p>
                            <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="accept_sub_cat_id_list">
                                {% for sub_cat in sub_cats %}
                                {% if set_sc|index:forloop.counter0 != None %}
                                <optgroup label="{{set_sc|index:forloop.counter0}}">
                                {% endif %}
                                <option value="{{sub_cat.id}}">▪️ {{sub_cat.name|title}}</option>
                                {% if set_sc|index:forloop.counter1 != None %}
                                </optgroup>
                                {% endif %}
                                {% endfor %}
                            </select>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-success" onclick="accept_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Reject -->
          <div id="reject_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-times me-1'></i>Reject</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to reject this request ?</h5>
                          <div class="form-check form-checkbox-danger mb-3">
                            <input type="checkbox" class="form-check-input" id="is_nms">
                            <label class="form-check-label" for="is_nms">This request is not for <span class="text-danger">{{req.sg.name}}</span> section.</label>
                          </div>
                          <div class="mb-0" id="ms_group">
                              <label class="form-label">Reject Reason</label>
                              <textarea class="form-control" name="reject_reason" id="reject_reason" rows="5"></textarea>
                          </div>
                          <div class="mb-3" id="nms_group" hidden>
                            <label class="form-label">Request To..</label><br>
                            <select class="form-control select2" data-toggle="select2" name="reject_sg_name" id="reject_sg_name">
                              {% for sg in sgs %}
                              <option value="{{sg.name}}" {% if re.sg.name == sg.name %}selected{% endif %}>{{sg.name}}</option>
                              {% endfor %}
                            </select>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="reject_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Hold -->
          <div id="hold_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-dark">
                          <h4 class="modal-title"><i class='uil-pause me-1'></i>Hold</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to hold this request ?</h5>
                          <div class="mb-0">
                              <label class="form-label">Hold Reason</label>
                              <textarea class="form-control" name="hold_reason" id="hold_reason" rows="5"></textarea>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-dark" onclick="hold_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Start Work -->
          <div id="start_work_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-primary">
                          <h4 class="modal-title"><i class='uil-play me-1'></i>Start Work</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to start work this request ?</h5>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-primary" onclick="start_work_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Complete -->
          <div id="complete_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-success">
                          <h4 class="modal-title"><i class='mdi mdi-check-all me-1'></i>Complete</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to complete this request ?</h5>
                          <div class="mb-1">
                              <label class="form-label">Corrective Action</label>
                              <textarea class="form-control" name="complete_corrective_action" id="complete_corrective_action" rows="5">{{req.corrective_action|default_if_none:""}}</textarea>
                          </div>
                          <div class="mb-1">
                              <label class="form-label">Cause</label>
                              <textarea class="form-control" name="complete_cause" id="complete_cause" rows="5">{{req.cause|default_if_none:""}}</textarea>
                          </div>
                          <div class="mb-0">
                              <label class="form-label">Spare Parts Changed</label>
                              <textarea class="form-control" name="complete_spare_parts" id="complete_spare_parts" rows="5">{{req.spare_parts|default_if_none:""}}</textarea>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-success" onclick="complete_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Cancel -->
          <div id="cancel_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-ban me-1'></i>Cancel</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to cancel this request ?</h5>
                          <div class="mb-0">
                              <label class="form-label">Cancel Reason</label>
                              <textarea class="form-control" name="cancel_reason" id="cancel_reason" rows="5"></textarea>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="cancel_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Rework -->
          <div id="rework_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-info">
                          <h4 class="modal-title"><i class='uil-redo me-1'></i>Rework</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to rework this request ?</h5>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-info" onclick="rework_request()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Manage Member -->
          <div id="manage_member_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-info">
                          <h4 class="modal-title"><i class='mdi mdi-account-edit me-1'></i>Manage Member</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <div class="mb-3">
                            <label class="form-label">Member</label>
                            <p class="text-muted font-12">Use 'CTRL' to select multiple item, Please select at least 1 person.</p>
                            <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="mm_username_list">
                                {% for user in users %}
                                {% if set_user|index:forloop.counter0 != None %}
                                <optgroup label="{{set_user|index:forloop.counter0}}">
                                {% endif %}
                                <option value="{{user.username}}" {% if selected_members|index:forloop.counter0 %}selected{% endif %}>{{user.username}} | {{user.employee.name|title}}</option>
                                {% if set_user|index:forloop.counter1 != None %}
                                </optgroup>
                                {% endif %}
                                {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <p class="text-info text-center font-12"><i class='mdi mdi-information-outline'></i> Leaving member working time won't be deleted.</p>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-info" onclick="manage_member()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Manage Vendor -->
          <div id="manage_vendor_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-info">
                          <h4 class="modal-title"><i class='mdi mdi-briefcase-edit me-1'></i>Manage Vendor</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <div class="mb-3">
                            <label class="form-label">Vendor</label>
                            <p class="text-muted font-12">Use 'CTRL' to select multiple item</p>
                            <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="mv_ven_code_list">
                                {% for ven in vens %}
                                <option value="{{ven.code}}" {% if selected_vendors|index:forloop.counter0 %}selected{% endif %}>{{ven.code}} | {{ven.name}}</option>
                                {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <p class="text-info text-center font-12"><i class='mdi mdi-information-outline'></i> Leaving vendor working time won't be deleted.</p>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-info" onclick="manage_vendor()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Manage Category -->
          <div id="manage_category_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-info">
                          <h4 class="modal-title"><i class='mdi mdi-puzzle-edit me-1'></i>Manage Category</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <div class="mb-3">
                            <label class="form-label">Category</label>
                            <p class="text-muted font-12">Use 'CTRL' to select multiple item</p>
                            <select class="select2 form-control select2-multiple" data-toggle="select2" multiple="multiple" data-placeholder="Choose ..." id="mc_sub_cat_id_list">
                                {% for sub_cat in sub_cats %}
                                {% if set_sc|index:forloop.counter0 != None %}
                                <optgroup label="{{set_sc|index:forloop.counter0}}">
                                {% endif %}
                                <option value="{{sub_cat.id}}" {% if selected_sc|index:forloop.counter0 %}selected{% endif %}>▪️ {{sub_cat.name|title}}</option>
                                {% if set_sc|index:forloop.counter1 != None %}
                                </optgroup>
                                {% endif %}
                                {% endfor %}
                            </select>
                          </div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-info" onclick="manage_category()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Delete File -->
          <div id="delete_file_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-trash me-1'></i>Delete File</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to delete this file ?</h5>
                          <input type="text" id="delete_file_id" hidden>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="delete_file()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Delete Comment -->
          <div id="delete_comment_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-trash me-1'></i>Delete Comment</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to delete this comment ?</h5>
                          <input type="text" id="delete_comment_id" hidden>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="delete_comment()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Delete Operator Working Time -->
          <div id="delete_owt_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-trash me-1'></i>Delete Operator Working Time</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to delete this operator working time ?</h5>
                          <input type="text" id="delete_owt_id" hidden>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="delete_owt()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Delete Vendor Working Time -->
          <div id="delete_vwt_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-trash me-1'></i>Delete Vendor Working Time</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to delete this vendor working time ?</h5>
                          <input type="text" id="delete_vwt_id" hidden>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="delete_vwt()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Delete Machine Downtime -->
          <div id="delete_mcdt_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-trash me-1'></i>Delete Machine Downtime</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to delete this machine downtime ?</h5>
                          <input type="text" id="delete_mcdt_id" hidden>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="delete_mcdt()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
          <!-- Delete Costing -->
          <div id="delete_cost_modal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog">
                  <div class="modal-content">
                      <div class="modal-header modal-colored-header bg-danger">
                          <h4 class="modal-title"><i class='uil-trash me-1'></i>Delete Costing</h4>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <h5 class="mt-3 mb-3 text-center">Are you sure that you want to delete this costing ?</h5>
                          <input type="text" id="delete_cost_id" hidden>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-danger" onclick="delete_cost()">Confirm</button>
                      </div>
                  </div>
              </div>
          </div>
        </div>

        <!-- bundle -->
        <script src="{% static "assets/js/vendor.min.js" %}"></script>
        <script src="{% static "assets/js/app.min.js" %}"></script>
        <script src="{% static "custom/custom.js" %}"></script>
        <script src="{% static "custom/topsearch.js" %}"></script>
        <!-- DataTable -->
        <script src="{% static "assets/js/vendor/jquery.dataTables.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/dataTables.bootstrap5.js" %}"></script>
        <script src="{% static "assets/js/vendor/dataTables.responsive.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/responsive.bootstrap5.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/dataTables.buttons.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/buttons.bootstrap5.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/buttons.html5.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/buttons.flash.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/buttons.print.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/dataTables.keyTable.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/dataTables.select.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/fixedColumns.bootstrap5.min.js" %}"></script>
        <script src="{% static "assets/js/vendor/fixedHeader.bootstrap5.min.js" %}"></script>

        <script>
          $('#basic-datatable').DataTable( {
              "order": [[ 0, "asc" ]],
              'iDisplayLength': 100,
              "scrollX": true,
              dom: 'Bfrtip',
              buttons: [
                // 'excelHtml5',
                // 'csvHtml5',
              ]
          });

          $('#accept_mc_no').select2({
              dropdownParent: $('#accept_modal')
          });

          $('#accept_username_list').select2({
              dropdownParent: $('#accept_modal')
          });

          $('#accept_ven_code_list').select2({
              dropdownParent: $('#accept_modal')
          });

          $('#accept_sub_cat_id_list').select2({
              dropdownParent: $('#accept_modal')
          });

          $('#reject_sg_name').select2({
              dropdownParent: $('#reject_modal')
          });

          $('#mm_username_list').select2({
              dropdownParent: $('#manage_member_modal')
          });

          $('#mv_ven_code_list').select2({
              dropdownParent: $('#manage_vendor_modal')
          });

          $('#mc_sub_cat_id_list').select2({
              dropdownParent: $('#manage_category_modal')
          });

          function accept_request(){
            var req_id = $("#req_id").val();
            var mc_no = $("#accept_mc_no").val();
            var username_list = $("#accept_username_list").val();
            var ven_code_list = $("#accept_ven_code_list").val();
            var sub_cat_id_list = $("#accept_sub_cat_id_list").val();
            if(username_list.length > 0){
              $.ajax({
                url: '/accept_request/',
                data: {
                  'req_id': req_id,
                  'mc_no': mc_no,
                  'username_list': username_list,
                  'ven_code_list': ven_code_list,
                  'sub_cat_id_list': sub_cat_id_list,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function reject_request(){
            var req_id = $("#req_id").val();
            var is_nms = $('#is_nms').is(':checked');
            var reject_reason = $("#reject_reason").val();
            var sg_name = $("#reject_sg_name").val();
            $.ajax({
              url: '/reject_request/',
              data: {
                'req_id': req_id,
                'is_nms': is_nms,
                'reject_reason': reject_reason,
                'sg_name': sg_name,
              },
              dataType: 'json',
              success: function (data) {
                if(is_nms){
                  window.location.href = '/index/';
                } else {
                  location.reload();
                }
              }
            });
          }

          function join_request(){
            var req_id = $("#req_id").val();
            $.ajax({
              url: '/join_request/',
              data: {
                'req_id': req_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function leave_request(){
            var req_id = $("#req_id").val();
            $.ajax({
              url: '/leave_request/',
              data: {
                'req_id': req_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function hold_request(){
            var req_id = $("#req_id").val();
            var hold_reason = $("#hold_reason").val();
            $.ajax({
              url: '/hold_request/',
              data: {
                'req_id': req_id,
                'hold_reason': hold_reason,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function start_work_request(){
            var req_id = $("#req_id").val();
            $.ajax({
              url: '/start_work_request/',
              data: {
                'req_id': req_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function complete_request(){
            var req_id = $("#req_id").val();
            var corrective_action = $("#complete_corrective_action").val();
            var cause = $("#complete_cause").val();
            var spare_parts = $("#complete_spare_parts").val();
            $.ajax({
              url: '/complete_request/',
              data: {
                'req_id': req_id,
                'corrective_action': corrective_action,
                'cause': cause,
                'spare_parts': spare_parts,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function cancel_request(){
            var req_id = $("#req_id").val();
            var cancel_reason = $("#cancel_reason").val();
            $.ajax({
              url: '/cancel_request/',
              data: {
                'req_id': req_id,
                'cancel_reason': cancel_reason,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function rework_request(){
            var req_id = $("#req_id").val();
            $.ajax({
              url: '/rework_request/',
              data: {
                'req_id': req_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function manage_member(){
            var req_id = $("#req_id").val();
            var username_list = $("#mm_username_list").val();
            if(username_list.length > 0){
              $.ajax({
                url: '/manage_member/',
                data: {
                  'req_id': req_id,
                  'username_list': username_list,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function manage_vendor(){
            var req_id = $("#req_id").val();
            var ven_code_list = $("#mv_ven_code_list").val();
            $.ajax({
              url: '/manage_vendor/',
              data: {
                'req_id': req_id,
                'ven_code_list': ven_code_list,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function manage_category(){
            var req_id = $("#req_id").val();
            var sub_cat_id_list = $("#mc_sub_cat_id_list").val();
            $.ajax({
              url: '/manage_category/',
              data: {
                'req_id': req_id,
                'sub_cat_id_list': sub_cat_id_list,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function post_comment(){
            var req_id = $("#req_id").val();
            var comment_text = $("#comment_text").val();
            if(comment_text.length > 0){
              $.ajax({
                url: '/post_comment/',
                data: {
                  'req_id': req_id,
                  'comment_text': comment_text,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function prepare_delete_file(file_id){
            $("#delete_file_id").val(file_id);
          }

          function delete_file(){
            var file_id = $("#delete_file_id").val();
            $.ajax({
              url: '/delete_file/',
              data: {
                'file_id': file_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function prepare_delete_comment(comment_id){
            $("#delete_comment_id").val(comment_id);
          }

          function delete_comment(){
            var comment_id = $("#delete_comment_id").val();
            $.ajax({
              url: '/delete_comment/',
              data: {
                'comment_id': comment_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function owt_save(){
            var req_id = $("#req_id").val();
            var username_list = $("#owt_username_list").val();
            var start_datetime = $("#owt_start_datetime").val();
            var stop_datetime = $("#owt_stop_datetime").val();
            if(username_list.length > 0 && start_datetime != "" && stop_datetime != "" && stop_datetime > start_datetime && new Date(stop_datetime) < new Date()){
              $.ajax({
                url: '/owt_save/',
                data: {
                  'req_id': req_id,
                  'username_list': username_list,
                  'start_datetime': start_datetime,
                  'stop_datetime': stop_datetime,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function prepare_delete_owt(owt_id){
            $("#delete_owt_id").val(owt_id);
          }

          function delete_owt(){
            var owt_id = $("#delete_owt_id").val();
            $.ajax({
              url: '/delete_owt/',
              data: {
                'owt_id': owt_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function vwt_save(){
            var req_id = $("#req_id").val();
            var ven_code_list = $("#vwt_ven_code_list").val();
            var start_datetime = $("#vwt_start_datetime").val();
            var stop_datetime = $("#vwt_stop_datetime").val();
            if(ven_code_list.length > 0 && start_datetime != "" && stop_datetime != "" && stop_datetime > start_datetime && new Date(stop_datetime) < new Date()){
              $.ajax({
                url: '/vwt_save/',
                data: {
                  'req_id': req_id,
                  'ven_code_list': ven_code_list,
                  'start_datetime': start_datetime,
                  'stop_datetime': stop_datetime,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function prepare_delete_vwt(vwt_id){
            $("#delete_vwt_id").val(vwt_id);
          }

          function delete_vwt(){
            var vwt_id = $("#delete_vwt_id").val();
            $.ajax({
              url: '/delete_vwt/',
              data: {
                'vwt_id': vwt_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function mcdt_save(){
            var req_id = $("#req_id").val();
            var mc_no = $("#mcdt_mc_no").val();
            var start_datetime = $("#mcdt_start_datetime").val();
            var stop_datetime = $("#mcdt_stop_datetime").val();
            if(start_datetime != "" && stop_datetime != "" && stop_datetime > start_datetime && new Date(stop_datetime) < new Date()){
              $.ajax({
                url: '/mcdt_save/',
                data: {
                  'req_id': req_id,
                  'mc_no': mc_no,
                  'start_datetime': start_datetime,
                  'stop_datetime': stop_datetime,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function prepare_delete_mcdt(mcdt_id){
            $("#delete_mcdt_id").val(mcdt_id);
          }

          function delete_mcdt(){
            var mcdt_id = $("#delete_mcdt_id").val();
            $.ajax({
              url: '/delete_mcdt/',
              data: {
                'mcdt_id': mcdt_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          function cost_save(){
            var req_id = $("#req_id").val();
            var name = $("#cost_name").val();
            var price = $("#cost_price").val();
            if(name != "" && price != ""){
              $.ajax({
                url: '/cost_save/',
                data: {
                  'req_id': req_id,
                  'name': name,
                  'price': price,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }

          function prepare_delete_cost(cost_id){
            $("#delete_cost_id").val(cost_id);
          }

          function delete_cost(){
            var cost_id = $("#delete_cost_id").val();
            $.ajax({
              url: '/delete_cost/',
              data: {
                'cost_id': cost_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }

          //-- Toggle
          $('#is_nms').on("change", function() {
            var is_nms = $('#is_nms').is(':checked')
            if(is_nms){
              unhide("nms_group");
              hide("ms_group");
            } else {
              hide("nms_group");
              unhide("ms_group");
            }
          });
        </script>

    </body>
</html>
